<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="css/mui.min.css">
		<style>
			html,
			body {
				background-color: #efeff4;
			}
			
			p {
				text-indent: 22px;
			}
			
			span.mui-icon {
				font-size: 14px;
				color: #007aff;
				margin-left: -15px;
				padding-right: 10px;
			}
			
			.main-title {
				color: #FF0000;
			}
			
			.mui-off-canvas-left {
				color: #ccc;
			}
			
			.title {
				margin: 35px 15px 10px;
			}
			
			.title+.content {
				margin: 10px 15px 35px;
				color: #bbb;
				text-indent: 1em;
				font-size: 14px;
				line-height: 24px;
			}
			
			.view-pager {
				margin: 10px 10 px 10px 10px;
				height: 120px;
			}
			
			input {
				color: #000;
			}
		</style>
	</head>

	<body>
		<div id="offCanvasWrapper" class="mui-off-canvas-wrap mui-draggable mui-content">
			<!--侧滑菜单部分-->
			<aside id="offCanvasSide" class="mui-off-canvas-left">
				<div id="offCanvasSideScroll" class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<!--<div class="title">郑家兴</div>
						<div class="content">
							数计学院
						</div>-->
						<div id="name-or-unlogin" class="title">未登录</div>
						<div id="dept-or-btn" class="content">
							<button id="login-btn-pre" type="button">登录</button>
						</div>
						<ul class="mui-table-view mui-table-view-chevron mui-table-view-inverted">
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right" href="page/tab-book_ticket.html">
									我要订票
								</a>
							</li>
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right" href="page/tab-my_tickets.html">
									我的车票
								</a>
							</li>
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right" href="page/tab-my_orders.html">
									我的订单
								</a>
							</li>
						</ul>
						<ul class="mui-table-view mui-table-view-chevron mui-table-view-inverted" style="margin-top: 25px;">
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right" href="page/tab-setting.html">
									设置
								</a>
							</li>
						</ul>
						<ul>
							<p id="layout" style="width:70%;margin-top:60px">
								<!--
                                	作者：396324491@qq.com
                                	时间：2015-12-25
                                	描述：不给button加display属性 因为可能js执行的比css早
                                -->
								<button id="layout-btn" type="button" class="mui-btn mui-btn-danger mui-btn-block" style="padding: 5px 20px;">注销</button>
							</p>
						</ul>
					</div>
				</div>
			</aside>
			<!--主界面部分-->
			<div class="mui-inner-wrap">
				<header class="mui-bar mui-bar-nav main-title">
					<a class="mui-icon mui-icon-bars mui-pull-left"></a>
					<h1 class="mui-title ">FZU晋狮同乡包车</h1>
				</header>
				<div id="offCanvasContentScroll" class="mui-content mui-scroll-wrapper">
					<div class="mui-content-padded">
						<div id="slider" class="mui-slider">
							<div class="mui-slider-group mui-slider-loop">
								<!-- 额外增加的一个节点(循环轮播：第一个节点是最后一张轮播) -->
								<div class="mui-slider-item mui-slider-item-duplicate">
									<a href="#">
										<img class="view-pager" src="images/activity_travel.jpg">
										<p class="mui-slider-title">出行旅游</p>
									</a>
								</div>
								<div class="mui-slider-item">
									<a href="#">
										<img class="view-pager" src="images/activity_mid-autumn.jpg">
										<p class="mui-slider-title">中秋博饼</p>
									</a>
								</div>
								<div class="mui-slider-item">
									<a href="#">
										<img class="view-pager" src="images/activity_food-festival.png">
										<p class="mui-slider-title">美食节</p>
									</a>
								</div>
								<div class="mui-slider-item">
									<a href="#">
										<img class="view-pager" src="images/activity_zhuxue.jpg">
										<p class="mui-slider-title">贫困助学</p>
									</a>
								</div>
								<div class="mui-slider-item">
									<a href="#">
										<img class="view-pager" src="images/activity_travel.jpg">
										<p class="mui-slider-title">出行旅游</p>
									</a>
								</div>
								<!-- 额外增加的一个节点(循环轮播：最后一个节点是第一张轮播) -->
								<div class="mui-slider-item mui-slider-item-duplicate">
									<a href="#">
										<img class="view-pager" src="images/activity_mid-autumn.jpg">
										<p class="mui-slider-title">中秋博饼</p>
									</a>
								</div>
							</div>
							<div class="mui-slider-indicator mui-text-right">
								<div class="mui-indicator mui-active"></div>
								<div class="mui-indicator"></div>
								<div class="mui-indicator"></div>
								<div class="mui-indicator"></div>
							</div>
						</div>
					</div>
					<div class="mui-content-padded">
						<p>
							【福大晋狮同乡会“美食节”来袭！】
						</p>
						<p>
							乡亲们，虽然出游活动取消但也不要失望哦！duang～duang～duang～本月同乡会将举办“吖吼呷”美食节活动！想要大展厨艺的老乡或者想要尝试一下下厨乐趣的老乡们都可以向理事报名参与美食节活动！活动中所需食材全部由同乡会包办，乡亲们只要带上你们最棒的厨艺到场参与就可以啦！活动中还有深沪拳头母，自制美味寿司、水饺等着广大吃货们来热情捧场哦！
							<p>
								<p>活动时间：11月21日（周六晚7.00）</p>
								<p>活动地点：玫瑰园二楼</p>
								<p>报名时间：11月20号晚9.00前</p>
					</div>
				</div>
				<!-- off-canvas backdrop -->
				<div class="mui-off-canvas-backdrop">
				</div>
			</div>
		</div>
		<script src="js/mui.min.js"></script>
		<script src="js/app.js"></script>
		<script>
			(function($, doc) {
				
				mui.init();
				//判断登录 未登录的话获得{}
					var showIsLogin = function() {
						console.log("showIsLogin");
							var state = app.getState();
							var layout = mui('#layout')[0];
							if (app.has_login()) {
								var usernameText = mui('#name-or-unlogin')[0];
								usernameText.innerHTML = state.name;
								var deptText = mui('#dept-or-btn')[0];
								deptText.innerHTML = state.dept;
								layout.style.display = "block";
							} else {
								var usernameText = mui('#name-or-unlogin')[0];
								usernameText.innerHTML = '未登录';
								var deptText = mui('#dept-or-btn')[0];
								deptText.innerHTML ="<button id='login-btn-pre' type='button'>登录</button>";
								layout.style.display = "none";
							}
						}
				//显示后才执行的函数,用来更新值
				window.addEventListener('show', function() {
					console.log("开始更新页面数据");
					showIsLogin();
				}, false);
				$.plusReady(function() {
					//关闭等待框
					plus.nativeUI.closeWaiting();
					//显示当前页面 回调show函数
					mui.currentWebview.show();
					//侧滑容器父节点
					var offCanvasWrapper = mui('#offCanvasWrapper');
					//主界面容器
					var offCanvasInner = offCanvasWrapper[0].querySelector('.mui-inner-wrap');
					//菜单容器
					var offCanvasSide = document.getElementById("offCanvasSide");
					//移动效果是否为整体移动
					var moveTogether = true;
					//侧滑容器的class列表，增加.mui-slide-in即可实现菜单移动、主界面不动的效果；
					var classList = offCanvasWrapper[0].classList;
					//变换侧滑动画移动效果；
					if (moveTogether) {
						//仅主内容滑动时，侧滑菜单在off-canvas-wrap内，和主界面并列
						offCanvasWrapper[0].insertBefore(offCanvasSide, offCanvasWrapper[0].firstElementChild);
					}
					classList.add('mui-scalable'); //增加仿qq侧滑
					offCanvasWrapper.offCanvas().refresh();
					//主界面和侧滑菜单界面均支持区域滚动；
					mui('#offCanvasSideScroll').scroll();
					mui('#offCanvasContentScroll').scroll();
					//实现ios平台原生侧滑关闭页面；
					if (mui.os.plus && mui.os.ios) {
						mui.plusReady(function() { //5+ iOS暂时无法屏蔽popGesture时传递touch事件，故该demo直接屏蔽popGesture功能
							plus.webview.currentWebview().setStyle({
								'popGesture': 'none'
							});
						});
					}
					//cope from pengYE
					//点击左上角侧滑图标，打开侧滑菜单；
					document.querySelector('.mui-icon-bars').addEventListener('tap', function(e) {
						offCanvasWrapper.offCanvas('show');
					});
					//重写mui.menu方法，Android版本menu按键按下可自动打开、关闭侧滑菜单；
					mui.menu = function() {
							offCanvasWrapper.offCanvas('show');
						}
						//首页返回键处理
						//处理逻辑：1秒内，连续两次按返回键，则退出应用；
					var first = null;
					mui.back = function() {
						//isShown函数判断侧滑菜单是否显示
						//offCanvas('show')方法:打开则关闭 关闭则打开
						if (offCanvasWrapper.offCanvas().isShown()) {
							offCanvasWrapper.offCanvas('show');
						} else {
							//首次按键，提示‘再按一次退出应用’
							if (!first) {
								first = new Date().getTime();
								mui.toast('再按一次退出应用');
								setTimeout(function() {
									first = null;
								}, 1000);
							} else {
								if (new Date().getTime() - first < 1000) {
									plus.runtime.quit();
								}
							}
						}
					};
						//主列表点击事件
					mui('.mui-scroll').on('tap', 'a', function() {
						var id = this.getAttribute('href');
						var href = this.href;
						//id 的值是href中的值"page/xxx.html" href是sd卡绝对路径
						//mui.toast(id+",,"+href);
						//js中 if(x)x<0也可以走只要不是为0
						//~id.indexOf('.html') 的目的是:
						/*
						 * String sb="abc.html";
						 当sb中不含有.html时
						 sb.indexOf('.html')=-1 取~为0
						 * */
						if (id && ~id.indexOf('.html')) {
							mui.openWindow({
								id: id,
								url: this.href,
								styles: {
									popGesture: 'close'
								},
								show: {
									autoShow: false
								},
								waiting: {
									autoShow: true
								}
							});
						}
					});
					mui(".mui-scroll").on('tap', '#login-btn-pre', function() {
						mui.openWindow({
							id: "login",
							url: "login.html",
							styles: {
								popGesture: 'close'
							},
							createNew:true,
							waiting: {
								autoShow: true
							}
						});
					});
					//注销事件
					mui(".mui-scroll").on('tap', '#layout-btn', function() {
						plus.nativeUI.showWaiting("注销中...");
						app.setState({});
						showIsLogin();
						plus.nativeUI.closeWaiting();
					});
					//图片轮播
					var slider = mui("#slider");
					slider.slider({
						interval: 3000
					});
					console.log("main pre end")
					showIsLogin();
				});
			}(mui, document));
		</script>
	</body>

</html>